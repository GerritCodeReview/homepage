{
  "comments": [
    {
      "key": {
        "uuid": "1bb21b82_68906798",
        "filename": "pages/design-docs/scaling-multi-master-replication/use-cases.md",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-10-17T07:13:14Z",
      "side": 1,
      "message": "Overall, there are hints to the implementation you have in mind \"leaking\" into the use-cases. That is fine, however, they should just be moved into the solution document.",
      "revId": "36775c4c7e09333992db724b99739c263c012692",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c3c7fa5d_524c1ad8",
        "filename": "pages/design-docs/scaling-multi-master-replication/use-cases.md",
        "patchSetId": 8
      },
      "lineNbr": 11,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-10-17T06:56:41Z",
      "side": 1,
      "message": "Can you share your current limits?\n- number of repos\n- number of destinations\n- number of ref-updates / hour, globally and per-repo\n- specs of the Gerrit master (# cores, RAM)\n\nUnderstanding your current limits and the associated bottlenecks would help selecting the right design for it.",
      "range": {
        "startLine": 11,
        "startChar": 14,
        "endLine": 11,
        "endChar": 33
      },
      "revId": "36775c4c7e09333992db724b99739c263c012692",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f9a26a1a_a2860971",
        "filename": "pages/design-docs/scaling-multi-master-replication/use-cases.md",
        "patchSetId": 8
      },
      "lineNbr": 40,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-10-17T06:56:41Z",
      "side": 1,
      "message": "40 threads isn\u0027t that much for nowadays servers.",
      "range": {
        "startLine": 40,
        "startChar": 78,
        "endLine": 40,
        "endChar": 88
      },
      "revId": "36775c4c7e09333992db724b99739c263c012692",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "aec79572_70c90225",
        "filename": "pages/design-docs/scaling-multi-master-replication/use-cases.md",
        "patchSetId": 8
      },
      "lineNbr": 42,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-10-17T07:13:14Z",
      "side": 1,
      "message": "10 destinations x 9 threads \u003d 90 threads, which still seems compatible with a large-scale server (e.g. 512 cores)",
      "range": {
        "startLine": 42,
        "startChar": 55,
        "endLine": 42,
        "endChar": 64
      },
      "revId": "36775c4c7e09333992db724b99739c263c012692",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "38747c99_4c04e088",
        "filename": "pages/design-docs/scaling-multi-master-replication/use-cases.md",
        "patchSetId": 8
      },
      "lineNbr": 45,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-10-17T07:13:14Z",
      "side": 1,
      "message": "Yes, fully agreed. They just increase the contentions on the shared resources.",
      "range": {
        "startLine": 44,
        "startChar": 32,
        "endLine": 45,
        "endChar": 14
      },
      "revId": "36775c4c7e09333992db724b99739c263c012692",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6988f61a_486493fa",
        "filename": "pages/design-docs/scaling-multi-master-replication/use-cases.md",
        "patchSetId": 8
      },
      "lineNbr": 47,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-10-17T07:13:14Z",
      "side": 1,
      "message": "Can you share them so that we have more context?",
      "range": {
        "startLine": 47,
        "startChar": 48,
        "endLine": 47,
        "endChar": 78
      },
      "revId": "36775c4c7e09333992db724b99739c263c012692",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4f016b7c_a7ae9cc5",
        "filename": "pages/design-docs/scaling-multi-master-replication/use-cases.md",
        "patchSetId": 8
      },
      "lineNbr": 54,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-10-17T07:13:14Z",
      "side": 1,
      "message": "Is this possibly the problem? I recall you mentioned that your repos have hundreds of thousands of refs and, without Git protocol v2, the refs-advertisement phase would be huge.",
      "range": {
        "startLine": 54,
        "startChar": 44,
        "endLine": 54,
        "endChar": 74
      },
      "revId": "36775c4c7e09333992db724b99739c263c012692",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0f141183_b637b97e",
        "filename": "pages/design-docs/scaling-multi-master-replication/use-cases.md",
        "patchSetId": 8
      },
      "lineNbr": 62,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-10-17T07:13:14Z",
      "side": 1,
      "message": "This is the use-case, whilst here you mention the solution. This statement should be moved into a solution description section.",
      "range": {
        "startLine": 62,
        "startChar": 66,
        "endLine": 62,
        "endChar": 93
      },
      "revId": "36775c4c7e09333992db724b99739c263c012692",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "45fecfd8_a7e0b3be",
        "filename": "pages/design-docs/scaling-multi-master-replication/use-cases.md",
        "patchSetId": 8
      },
      "lineNbr": 63,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-10-17T05:59:36Z",
      "side": 1,
      "message": "Even if you keep on adding more masters, you won\u0027t solve the concurrency issues on the same repo on NFS.\nAlready with 2 nodes, you have problems when two nodes are reading/writing to the same repo. If you scale up to 10-15-20 or over, the NFS would just become unbearable.\n\nI believe you need to get rid of the shared filesystem if you would like to scale up, including the replication side.\n\nAlternatively, seems obvious, but just buy more powerful hardware. It is not uncommon to see hosts with 512 or more CPUs. That would NOT increase the complexity of the replication plugin (which is WAY too high at the moment) and would be less risky.\n\nHaving said that, your use-case at Qualcomm could be different because your shared NFS, I believe, has caching disabled and directly fire-channel connected to the nodes. But in that case, also, adding more nodes with direct cables could be challenging, unless you add 10-20x network cards to the shared NFS.",
      "range": {
        "startLine": 63,
        "startChar": 4,
        "endLine": 63,
        "endChar": 75
      },
      "revId": "36775c4c7e09333992db724b99739c263c012692",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f54a4bf2_bdd63530",
        "filename": "pages/design-docs/scaling-multi-master-replication/use-cases.md",
        "patchSetId": 8
      },
      "lineNbr": 69,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-10-17T07:13:14Z",
      "side": 1,
      "message": "The replication plugin supports auto-reload of new destinations. We can work in making it differential so that the impact on existing replication tasks will be absolutely zero.",
      "range": {
        "startLine": 69,
        "startChar": 3,
        "endLine": 69,
        "endChar": 85
      },
      "revId": "36775c4c7e09333992db724b99739c263c012692",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "389d536e_8f9e53fc",
        "filename": "pages/design-docs/scaling-multi-master-replication/use-cases.md",
        "patchSetId": 8
      },
      "lineNbr": 86,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-10-17T07:13:14Z",
      "side": 1,
      "message": "The number of refs in a repo and the overall size of the new BLOBs are another *significant* limit to the replication system.",
      "range": {
        "startLine": 86,
        "startChar": 37,
        "endLine": 86,
        "endChar": 57
      },
      "revId": "36775c4c7e09333992db724b99739c263c012692",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5fedc4d6_e9e0e756",
        "filename": "pages/design-docs/scaling-multi-master-replication/use-cases.md",
        "patchSetId": 8
      },
      "lineNbr": 170,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-10-17T07:13:14Z",
      "side": 1,
      "message": "Why do you need to share them? You could distribute to the nodes without having to share them. (e.g. sharding)",
      "range": {
        "startLine": 170,
        "startChar": 38,
        "endLine": 170,
        "endChar": 67
      },
      "revId": "36775c4c7e09333992db724b99739c263c012692",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a096b4c7_e121db34",
        "filename": "pages/design-docs/scaling-multi-master-replication/use-cases.md",
        "patchSetId": 8
      },
      "lineNbr": 173,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-10-11T16:18:53Z",
      "side": 1,
      "message": "so task files are not written to a temp file and then atomically renamed like JGit e.g. does\nwhen writing pack files or checking out a version ?",
      "range": {
        "startLine": 173,
        "startChar": 30,
        "endLine": 173,
        "endChar": 66
      },
      "revId": "36775c4c7e09333992db724b99739c263c012692",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0ede87db_50dd977a",
        "filename": "pages/design-docs/scaling-multi-master-replication/use-cases.md",
        "patchSetId": 8
      },
      "lineNbr": 173,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2019-10-11T17:09:14Z",
      "side": 1,
      "message": "Correct, that is why my solution addresses both of these shortcomings first.",
      "parentUuid": "a096b4c7_e121db34",
      "range": {
        "startLine": 173,
        "startChar": 30,
        "endLine": 173,
        "endChar": 66
      },
      "revId": "36775c4c7e09333992db724b99739c263c012692",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "509c21a0_543357b2",
        "filename": "pages/design-docs/scaling-multi-master-replication/use-cases.md",
        "patchSetId": 8
      },
      "lineNbr": 173,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-10-11T17:39:10Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "0ede87db_50dd977a",
      "range": {
        "startLine": 173,
        "startChar": 30,
        "endLine": 173,
        "endChar": 66
      },
      "revId": "36775c4c7e09333992db724b99739c263c012692",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}