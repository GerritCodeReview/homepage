{
  "comments": [
    {
      "key": {
        "uuid": "f6cee6f0_9eff3de5",
        "filename": "pages/design-docs/global-refdb/solution-1.md",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-23T15:05:40Z",
      "side": 1,
      "message": "What is missing in this document is an introduction and motivation for a global ref-db.\nI see that this is at least partially discussed in the uses-cases.md but it would be\nbetter if the motivation for this new concept (global ref-db) is discussed and explained\nhere, before the \"Solution\" chapter begins.",
      "revId": "3fa669cb2c630250ab4de9fcefb0f696bfc3b061",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6c0d54ed_d6ac4342",
        "filename": "pages/design-docs/global-refdb/solution-1.md",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-23T19:19:44Z",
      "side": 1,
      "message": "\u003e What is missing in this document is an introduction and motivation for a global ref-db.\n\u003e I see that this is at least partially discussed in the uses-cases.md but it would be\n\u003e better if the motivation for this new concept (global ref-db) is discussed and explained\n\u003e here, before the \"Solution\" chapter begins.\n\nAre you suggesting to copy\u0026paste the design of the multi-site plugin? Or at least the relevant parts?",
      "parentUuid": "f6cee6f0_9eff3de5",
      "revId": "3fa669cb2c630250ab4de9fcefb0f696bfc3b061",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "68a56429_38d82c80",
        "filename": "pages/design-docs/global-refdb/solution-1.md",
        "patchSetId": 4
      },
      "lineNbr": 27,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-09-23T15:45:17Z",
      "side": 1,
      "message": "why AutoClosable and not something like Lock ?",
      "range": {
        "startLine": 27,
        "startChar": 3,
        "endLine": 27,
        "endChar": 16
      },
      "revId": "3fa669cb2c630250ab4de9fcefb0f696bfc3b061",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1584c5fc_ecf0e180",
        "filename": "pages/design-docs/global-refdb/solution-1.md",
        "patchSetId": 4
      },
      "lineNbr": 27,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-09-23T15:45:17Z",
      "side": 1,
      "message": "why not Ref ?",
      "range": {
        "startLine": 27,
        "startChar": 50,
        "endLine": 27,
        "endChar": 56
      },
      "revId": "3fa669cb2c630250ab4de9fcefb0f696bfc3b061",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6a802e2b_55577d62",
        "filename": "pages/design-docs/global-refdb/solution-1.md",
        "patchSetId": 4
      },
      "lineNbr": 48,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-09-23T15:45:17Z",
      "side": 1,
      "message": "detection of",
      "range": {
        "startLine": 48,
        "startChar": 15,
        "endLine": 48,
        "endChar": 21
      },
      "revId": "3fa669cb2c630250ab4de9fcefb0f696bfc3b061",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "931f2227_d03ef2c3",
        "filename": "pages/design-docs/global-refdb/solution-1.md",
        "patchSetId": 4
      },
      "lineNbr": 70,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-09-23T08:44:23Z",
      "side": 1,
      "message": "JGit would be the correct place for this IMO. Gerrit\u0027s use of JGit is as simple as calling it\u0027s interfaces. JGit already differentiates between a FileRepository and a DfsRepository. The idea of the Dfs one is that it is distributed to some extent. I think providing your own implementation for a DfsRefDatabase is the way to go. The implementation will be way simpler and more bullet proof because you essentially just provide this one class with a bunch of extra helpers and make sure the biding is correct. You will also avoid any inter-plugin dependency headache.\n\nIf on the other hand, this is implemented as a Gerrit plugin, we\u0027d have to ensure that it is called properly whenever an update is done. So we would create the necessity for calling a plugin endpoint before calling JGit.",
      "range": {
        "startLine": 69,
        "startChar": 0,
        "endLine": 70,
        "endChar": 89
      },
      "revId": "3fa669cb2c630250ab4de9fcefb0f696bfc3b061",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8b8986c2_72cce0a3",
        "filename": "pages/design-docs/global-refdb/solution-1.md",
        "patchSetId": 4
      },
      "lineNbr": 70,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-23T10:38:40Z",
      "side": 1,
      "message": "Hi Patrick, I believe your statement is coming from the Google\u0027s implementation of the global-refdb, correct?\n\nCan Google provide its design to the community (without the implementation, of course) so that we can all implement and benefit from alternative solutions?\n\nI believe Marcin\u0027s effort are great in trying and building something we can all use: having the input from Google and its design would be very helpful.\n\nP.S. Is Google\u0027s global-refdb part of JGit and available as an Eclipse project?",
      "parentUuid": "931f2227_d03ef2c3",
      "range": {
        "startLine": 69,
        "startChar": 0,
        "endLine": 70,
        "endChar": 89
      },
      "revId": "3fa669cb2c630250ab4de9fcefb0f696bfc3b061",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1014bd9c_3b586b5a",
        "filename": "pages/design-docs/global-refdb/solution-1.md",
        "patchSetId": 4
      },
      "lineNbr": 70,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-09-23T15:45:17Z",
      "side": 1,
      "message": "I second Patrick\u0027s opinion that this should be implemented as another project (bundle) in JGit.\nIf needed we can add multiple projects for implementations using different storage technology\n(Zookeeper, Cassandra, TiDB, ...)\n\nLuca: I think the gist of the algorithm implemented by Google was discussed at the Munich hackathon in May 2019,\nsee https://groups.google.com/forum/#!topic/gerrit-hackathon-muc-2019/Zh7c9Qy94sE",
      "parentUuid": "8b8986c2_72cce0a3",
      "range": {
        "startLine": 69,
        "startChar": 0,
        "endLine": 70,
        "endChar": 89
      },
      "revId": "3fa669cb2c630250ab4de9fcefb0f696bfc3b061",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0bb7f89e_ea36d8d1",
        "filename": "pages/design-docs/global-refdb/solution-1.md",
        "patchSetId": 4
      },
      "lineNbr": 70,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-23T15:48:53Z",
      "side": 1,
      "message": "\u003e Luca: I think the gist of the algorithm implemented by Google was discussed at the Munich hackathon in May 2019,\n\u003e see https://groups.google.com/forum/#!topic/gerrit-hackathon-muc-2019/Zh7c9Qy94sE\n\nYes, and I recall that Dave mentioned that they had a JGit wrapper in Gerrit that was using Spanner as a global ref-db. I was just curious IF Google could actually share the interface definition of that global refdb (IF it was abstract) and contribute to the JGit project.\n\nAt the moment, I believe (but I\u0027m not 100% sure) it is only in the Google\u0027s custom code-base.",
      "parentUuid": "1014bd9c_3b586b5a",
      "range": {
        "startLine": 69,
        "startChar": 0,
        "endLine": 70,
        "endChar": 89
      },
      "revId": "3fa669cb2c630250ab4de9fcefb0f696bfc3b061",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2d2d2fe8_a7be4a7a",
        "filename": "pages/design-docs/global-refdb/solution-1.md",
        "patchSetId": 4
      },
      "lineNbr": 70,
      "author": {
        "id": 1011842
      },
      "writtenOn": "2019-09-24T03:25:31Z",
      "side": 1,
      "message": "\u003e I was just curious IF Google could actually share the interface definition of that global refdb (IF it was abstract) and contribute to the JGit project.\n\nIt\u0027s ordinary DfsRefDatabase.\n\nActually most of DfsRefDatabase doesn\u0027t end up being useful, since the scanAllRefs approach in that class is not great for getRefsByPrefix access patterns. A better interface to work with is DfsReftableDatabase.\n\n\u003e I second Patrick\u0027s opinion that this should be implemented as another project (bundle) in JGit.\n\u003e If needed we can add multiple projects for implementations using different storage technology (Zookeeper, Cassandra, TiDB, ...)\n\nYes. I\u0027m happy to help with reviews and advice.",
      "parentUuid": "0bb7f89e_ea36d8d1",
      "range": {
        "startLine": 69,
        "startChar": 0,
        "endLine": 70,
        "endChar": 89
      },
      "revId": "3fa669cb2c630250ab4de9fcefb0f696bfc3b061",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "73bd6177_07c7ae3e",
        "filename": "pages/design-docs/global-refdb/solution-1.md",
        "patchSetId": 4
      },
      "lineNbr": 84,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-09-23T08:44:23Z",
      "side": 1,
      "message": "The fact that we don\u0027t have inter-plugin dependencies present a major drawback for the proposed solution I think. just because there are a handful of plugins that will want to use this functionality.",
      "range": {
        "startLine": 83,
        "startChar": 0,
        "endLine": 84,
        "endChar": 27
      },
      "revId": "3fa669cb2c630250ab4de9fcefb0f696bfc3b061",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a1928dc4_77e3cce9",
        "filename": "pages/design-docs/global-refdb/solution-1.md",
        "patchSetId": 4
      },
      "lineNbr": 84,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-23T15:52:29Z",
      "side": 1,
      "message": "\u003e The fact that we don\u0027t have inter-plugin dependencies present a major drawback for the proposed solution I think. just because there are a handful of plugins that will want to use this functionality.\n\nWe do have and use plugin dependency:\n- the multi-site plugin depends on the replication plugin and implements one of its extension points\n- the its-jira plugin dependes on the its-base plugin and implements one of its interfaces.",
      "parentUuid": "73bd6177_07c7ae3e",
      "range": {
        "startLine": 83,
        "startChar": 0,
        "endLine": 84,
        "endChar": 27
      },
      "revId": "3fa669cb2c630250ab4de9fcefb0f696bfc3b061",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0a06ceb8_65df858c",
        "filename": "pages/design-docs/global-refdb/solution-1.md",
        "patchSetId": 4
      },
      "lineNbr": 111,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2019-09-23T15:45:17Z",
      "side": 1,
      "message": "how about a non-dummy implementation which can be used in production at some point in time ?",
      "revId": "3fa669cb2c630250ab4de9fcefb0f696bfc3b061",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e421b84b_76dcb233",
        "filename": "pages/design-docs/global-refdb/solution-1.md",
        "patchSetId": 4
      },
      "lineNbr": 111,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-23T15:52:29Z",
      "side": 1,
      "message": "I believe anyone could write one of those: I would love Google to share their Spanner-based implementation.",
      "parentUuid": "0a06ceb8_65df858c",
      "revId": "3fa669cb2c630250ab4de9fcefb0f696bfc3b061",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}