{
  "comments": [
    {
      "key": {
        "uuid": "023537b5_e9e500fa",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 61,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2019-06-19T20:21:49Z",
      "side": 1,
      "message": "What advantage do we get by adding this data to a new file instead of adding it to the account.config file?",
      "range": {
        "startLine": 61,
        "startChar": 78,
        "endLine": 61,
        "endChar": 82
      },
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "243f9b90_cb7e0b8b",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 61,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-08T12:55:17Z",
      "side": 1,
      "message": "Basically, separation of concerns.\n\nOne could make the argument that you then need to read two files, but this is negligible given that the whole account info entity is cached and read from disk infrequently.",
      "parentUuid": "023537b5_e9e500fa",
      "range": {
        "startLine": 61,
        "startChar": 78,
        "endLine": 61,
        "endChar": 82
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "505f8f9d_08b54a10",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 61,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2019-07-08T14:55:18Z",
      "side": 1,
      "message": "Since it doesn\u0027s sound like there is a good reason to keep this data in a separate file, I think it would be more appropriate to put this in account.config. I suspect that if you do, you will eliminate the awkwardness or nee for the extra accountid keys that you are describing below.",
      "parentUuid": "243f9b90_cb7e0b8b",
      "range": {
        "startLine": 61,
        "startChar": 78,
        "endLine": 61,
        "endChar": 82
      },
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6c5fab55_4bc9cce3",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 61,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-08T15:18:40Z",
      "side": 1,
      "message": "I don\u0027t mind much either way, it would be in line with the current structure though:\n\naccount.config - stores account metadata\npreference.config - stores preferences\n(new) external-ids.config - stores external IDs",
      "parentUuid": "505f8f9d_08b54a10",
      "range": {
        "startLine": 61,
        "startChar": 78,
        "endLine": 61,
        "endChar": 82
      },
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f801cbe0_50414a8e",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2019-06-19T20:21:49Z",
      "side": 1,
      "message": "Would this only even be the account that this ref is for?",
      "range": {
        "startLine": 64,
        "startChar": 20,
        "endLine": 64,
        "endChar": 26
      },
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8226b11c_7c0088ec",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-08T12:55:17Z",
      "side": 1,
      "message": "Yes, as it stands, this doesn\u0027t look like it makes a lot of sense, but it separates the externald IDs with the key as subsection. This means that we can add key/value pairs easily in the future without a data migration.\n\nFrom [1] it wasn\u0027t obvious to me that one could omit all key/values in a subsection and still have a valid config file. Example\n\n[externalId \"\u003cexternal-id-key-1\u003e\"]\n[externalId \"\u003cexternal-id-key-2\u003e\"]\n\nIf that is the case in all relevant implementations (c-git and JGit) we can just omit the account ID.\n\nI\u0027ll check this before implementing it.\n\n[1] https://git-scm.com/docs/git-config#_syntax",
      "parentUuid": "f801cbe0_50414a8e",
      "range": {
        "startLine": 64,
        "startChar": 20,
        "endLine": 64,
        "endChar": 26
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c1d77095_af65ae66",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 65,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2019-06-24T07:32:56Z",
      "side": 1,
      "message": "-2 ?",
      "range": {
        "startLine": 65,
        "startChar": 29,
        "endLine": 65,
        "endChar": 32
      },
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "02e18edf_0aa2fe38",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 65,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-08T12:55:17Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c1d77095_af65ae66",
      "range": {
        "startLine": 65,
        "startChar": 29,
        "endLine": 65,
        "endChar": 32
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "40c0bd1a_6f64cf92",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 66,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2019-06-19T20:21:49Z",
      "side": 1,
      "message": "Maybe I don\u0027t fully understand what this data is. Is the data in these two entries intended to be different, or is only the external ID supposed to be different, and the accountId will be the same since it is all for the same account, the account the ref is for?",
      "range": {
        "startLine": 66,
        "startChar": 8,
        "endLine": 66,
        "endChar": 17
      },
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eff39131_e4a4d86b",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 66,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-08T12:55:17Z",
      "side": 1,
      "message": "The account ID would be the same, but it\u0027s essentially superfluous information.\n\nThe key of the subsection is the external ID.\n\nThis is essentially the same format as we have currently.",
      "parentUuid": "40c0bd1a_6f64cf92",
      "range": {
        "startLine": 66,
        "startChar": 8,
        "endLine": 66,
        "endChar": 17
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "daaaac5f_db606a35",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 74,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2019-06-19T20:21:49Z",
      "side": 1,
      "message": "Would this be refs that have only an index of other primary data (that would be on the refs/users/uu/vvvvvuu refs)?",
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3c9d4d32_edfe4b95",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 74,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-08T12:55:17Z",
      "side": 1,
      "message": "I am not quite sure I understand the question:\n\nThese refs are an index for data in refs/users/uu/vvvvvuu, so that you can find this data faster.\n\nSo from an email or an external ID, you can go to refs/users/uu/vvvvvuu which contains the email/external ID and more by using these refs.",
      "parentUuid": "daaaac5f_db606a35",
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "634ca5ef_8d9096d2",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 74,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2019-07-08T14:55:18Z",
      "side": 1,
      "message": "Sounds like the answer is \"yes\". We should only keep primary data in the git repos, index data belongs in our index.",
      "parentUuid": "3c9d4d32_edfe4b95",
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "09a35389_51b46da9",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 74,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-08T15:18:40Z",
      "side": 1,
      "message": "For external IDs, I disagree, for emails, I can see your point in part.\n\nWe need a way to authenticate a user even when the index subsystem is broken, down or stale. That means we need to to be able to resolve from ExternalID to Account.Id (and state) fast using only Git data.\nThe other strong reason is atomicity and staleness. For authenticating users, we can\u0027t afford any staleness for security reasons, so we have to leverage atomic ref updates. One could make an argument that after the index query we could do a cross-check of data and verify that the user that the index gave us really possesses the external ID we want to look up, but then, if that is not the case, there is no way but fail with a 500.\n\nAlso, we can\u0027t send a query to the index for every request because it is on the auth path because of latency.",
      "parentUuid": "634ca5ef_8d9096d2",
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "307c7817_5fa61dcb",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 74,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-08T15:23:56Z",
      "side": 1,
      "message": "... I forgot one of the main arguments actually: ExternalIDs need to be unique which is best enforced in primary storage.",
      "parentUuid": "09a35389_51b46da9",
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d07f2a5f_550e1ea4",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 176,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2019-06-19T16:45:46Z",
      "side": 1,
      "message": "retrieve",
      "range": {
        "startLine": 176,
        "startChar": 0,
        "endLine": 176,
        "endChar": 7
      },
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c6373021_f8b8dd88",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 176,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-08T12:55:17Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d07f2a5f_550e1ea4",
      "range": {
        "startLine": 176,
        "startChar": 0,
        "endLine": 176,
        "endChar": 7
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "450c48b5_17b15591",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 194,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2019-06-19T20:21:49Z",
      "side": 1,
      "message": "I think you mean on aggregate, I sure hope no individual user is spending this amount of time waiting? I suggest this be made clearer.",
      "range": {
        "startLine": 194,
        "startChar": 77,
        "endLine": 194,
        "endChar": 110
      },
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ece8db5e_8eabf45a",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 194,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-08T12:55:17Z",
      "side": 1,
      "message": "Done :-)",
      "parentUuid": "450c48b5_17b15591",
      "range": {
        "startLine": 194,
        "startChar": 77,
        "endLine": 194,
        "endChar": 110
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d6d6aae4_6c854bc1",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 212,
      "author": {
        "id": 1024147
      },
      "writtenOn": "2019-06-19T16:31:25Z",
      "side": 1,
      "message": "I thought it was also not wired up for use with Gerrit. Or did we fix that?",
      "range": {
        "startLine": 212,
        "startChar": 1,
        "endLine": 212,
        "endChar": 60
      },
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4c6564e6_140fdf0b",
        "filename": "pages/design-docs/external-id-storage-revamp/doc.md",
        "patchSetId": 1
      },
      "lineNbr": 212,
      "author": {
        "id": 1026112
      },
      "writtenOn": "2019-07-08T12:55:17Z",
      "side": 1,
      "message": "C-Git has no implementation and open-source admins are using c-Git to debug or as a last resort if Gerrit is in a broken state, so All-Users currently can\u0027t move to use RefTable.",
      "parentUuid": "d6d6aae4_6c854bc1",
      "range": {
        "startLine": 212,
        "startChar": 1,
        "endLine": 212,
        "endChar": 60
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "0580e96d346a611914f7ab8e115bcd0bd312138e",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}