---
title: "Gerrit 3.5.0 release"
permalink: 3.5.html
hide_sidebar: true
hide_navtoggle: true
toc: true
---

Download: **TBD**

Documentation: **TBD**

## Release highlights

### Case-insensitive usernames

Users can login with mixed case usernames without the risk to create
duplicate accounts.

The change affects the following external ids:
* `gerrit`   (LDAP)
* `username` (authentication REST and git endpoints)

For a new Gerrit setup, usernames are case insensitive by default, while for
existing installations the Gerrit admin can switch the functionality on/off
using the [`auth.userNameCaseInsensitive`](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/config-gerrit.html#auth.userNameCaseInsensitive)
setting in `gerrit.config`.

> **NOTE**: In the All-Users.git repository, the SHA-1 sum of the account
> is computed preserving the case of the external ID. See the full details
> in the [Gerrit config accounts documentation](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/config-accounts.html#external-ids). Existing accounts can be migrated to
> the new SHA-1 sum using the
> [ChangeExternalIdCaseSensitivity](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/pgm-ChangeExternalIdCaseSensitivity.html)
> migration tool.

### Request cancellation and execution deadlines

To limit the maximal execution time for requests, administrators can configure
server-side deadlines. More details are available in the
[Gerrit documentation](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/user-request-cancellation-and-deadlines.html
).

Any operation in Gerrit can now be subject to a configurable deadline, using
the [`deadline`](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/config-gerrit.html#deadline.id)
section in `gerrit.config`.

> **NOTE**: Deadlines are only supported for `REST`, `SSH` and `GIT_RECEIVE`
> requests, but not for `GIT_UPLOAD` requests.

Gerrit commands can define an execution deadline, so that the processing
triggered on the server would be able to end in a definite time, even in case
of network interruption of the connection with the client.

### Removal of external ids

Gerrit external ids, including the username, can now be removed using the
[SSH command](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/cmd-set-account.html)
or [REST API](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/rest-api-accounts.html#delete-account-external-ids).

> **NOTE**: Users that have the __Modify Account__ permission can delete
> external ids that belong to other accounts. External ids in the `username`
> scheme can only be deleted by users that have __Administrate Server__
> or both `Maintain Server` and `Modify Account`. See the
> [documentation](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/rest-api-accounts.html#delete-account-external-ids)
> for further details.

### Copy labels to new patch-sets

Gerrit can matches patch set approvals against the provided query
string and, if the query matches, the approval is copied from one patch set
to the next.

The copy label feature is controlled by the
[`label.Label-Name.copyCondition`](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/config-labels.html#label_copyCondition)
in `project.config`.

### Submit requirements

The change screen can now display the requirements that are needed for a change
to be merged.

### New changes predicates

It is possible to search for changes by uploader, using the new
[`uploader` and `uploaderin`](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/user-search.html#uploader)
predicates.

Hashtags search is improved with [`inhashtag`](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/user-search.html#inhashtag)
predicate which returns all the changes where any hashtag contains a substring,
using a full-text search.

Searching for attention-set changes supports now the
[`has:attention` and `is:attention` predicates](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/user-search.html#has-attention)
which returns all the changes where the attention-set by the current user.

Cherry-picked changes are now returned using the
[`is:cherrypick`](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/user-search.html#cherrypick)
predicate.

### Performance improvements on the change screen

The change screen has been improved by enabling extra caching and disabling
some expensive computation.

A new [`approvals` cache](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/config-gerrit.html#cache_names)
contains approvals for a given patch set.

The new [`change.conflictsPredicateEnabled`](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/config-gerrit.html#change.conflictsPredicateEnabled)
setting in `gerrit.config` disables the computation of the conflicts section
avoiding the computation of a complexity of O(nË†2).
When set to false GUI will silently ignore the error message and leave the
conflict changes section on change screen empty.

## Important notes

### Support for Java 8 dropped

The java language level is now set to Java 11 for Gerrit, the support
for Java 8 is dropped.

Gerrit source code may not be compatible with Java 8 anymore.

### Schema changes

This release doesn't contain schema changes since Gerrit v3.3.x, which means
that you can potentially upgrade directly skipping v3.4.x.

The changes index version has been increased to version 71. By default the
changes index is automatically rebuilt upon the Gerrit startup after the
upgrade.

To run off-line reindexing of the changes (optional):

```sh
  java -jar gerrit.war reindex --index changes -d site_path
```

### Zero-downtime upgrade

Gerrit supports zero-downtime upgrade from Gerrit v3.3.x or v3.4.x when
configured using a [high-availability configuration](https://gerrit.googlesource.com/plugins/high-availability/+/refs/heads/master/README.md),
and the Git repositories are stored in a shared filesystem such as NFS or
similar.

During the zero-downtime upgrade, Gerrit end-users would not notice any outage
or service disruption. They will be able to perform any read/write Gerrit
operation on the GUI or using the Git protocol.

The zero-downtime upgrade consists of the following steps:

1. Have Gerrit servers upgraded to v3.3.x or v3.4.x in high-availability
   configuration, healthy and able to handle the incoming traffic properly.
2. Set the Gerrit server unhealthy.
3. Shutdown the Gerrit server, update gerrit.war and plugins to v3.5.x and start
   Gerrit again.
4. Verify that the Gerrit server is working properly (e.g. run automated smoke
   tests) and then make it healthy again.
5. Wait for the Gerrit server to start serving traffic normally.
6. Repeat steps 2. to 5. for all the secondary Gerrit servers.

### Downgrade

Downgrade to any Gerrit v3.3.x or v3.4.x release is possible, but requires the
following manual steps:

1. Shutdown a migrated Gerrit v3.5.x servers
2. Update the gerrit.war and plugins to the previous v3.3.x or v3.4.x version
3. Run off-line reindexing using the previous gerrit.war version
3. Startup Gerrit server

### Breaking changes

* The support for [ElasticSearch index](https://gerrit-documentation.storage.googleapis.com/Documentation/3.4.1/config-gerrit.html#elasticsearch)
  is removed from Gerrit core. Existing setups can still use ElasticSearch through
  external non-core libModules.

* The "Reply" button label and tooltip cannot be customized anymore: the
  `change.replyLabel` and `change.replyTooltip` are ignored.

* The `repo_download` [`download.scheme`](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/config-gerrit.html#download.scheme)
  is renamed to `repo`.

* The `bower` Bazel rules are removed: all front-end plugins would have to
  migrate to `yarn`.

### Other changes

* Request tracing can exclude URI patterns, using the
  [`tracing.traceid.excludedRequestUriPattern`](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/config-gerrit.html#tracing.traceid.requestUriPattern)
  setting in `gerrit.config`.

* Git receive-pack can have a grace-period configurable as
[`receive.cancellationTimeout` setting](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/config-gerrit.html#receive.cancellationTimeout)
  for terminating after having received the cancellation signal from the client.

* Attention-set rules can be disabled upon push, using the
  [`--ignore-automatic-attention-set-rules` or `%ias` option](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/user-upload.html#ignore-attention-set).

### REST APIs

* [`AccountExternalIdInfo`](https://gerrit-documentation.storage.googleapis.com/Documentation/3.5.0/rest-api-accounts.html#account-external-id-info)
  `email` field is renamed to `email_address`.

* The `/accounts/link:#account-id[\{account-id\}]/stars.changes` endpoint
  is removed. Looking for starred changes is still available through the use
  of `is:starred` or `has:star` predicates.

## Plugin changes

* codemirror-editor

  * [Issue 14845](https://crbug.com/gerrit/14845):
  Improve performance in the editor

    Stop setting viewportMargin and instead use the default value.
    Add support for the inbuilt search support within codemirror.

* delete-project

  * Use base url for return url after deleting a repo

* plugin-manager

  * [Issue 13521](https://crbug.com/gerrit/13521):
  Use relative URL to access Gerrit base URL

    Plugin-manager now works for Gerrit setups
    with a reverse-proxy and a non-root base path.

* replication

  * [Issue 14819](https://crbug.com/gerrit/14819):
  Inherit remote replication events from a common parent.

  * [Issue 14628](https://crbug.com/gerrit/14628):
  Register ProjectDeletion events for gson serialization.

    ProjectDeletion events were not registered event types.
    This caused failures when EventGson tried to serialize/deserialize
    objects having those events as field, Throwing the JsonParseException:

    ```
    Unknown event type: project-deletion-replication-scheduled
    ```

  * Add a cluster replication configuration section.

    Add a section describing how to setup more than one primary to cooperate
    for replication and how this can impact cluster scaling and service
    levels.

## Gerrit UI changes

**TBC**

## Documentation changes

* PolyGerrit UI screenshots and associated documentation has been updated.

## JGit changes

**TBC**

## Other dependency changes

* Update auto-value-gson-\* to 1.3.1

* Update testcontainers to 1.15.3

* Update flogger to 0.6

* Update docker-java-\* to 3.2.8

* Update lucene-\* to 6.6.5

* Update polymer/decorators to 3.0.0

* Update polymer to 3.4.1

* Update typescript-api to 3.4.4

* Update lit to 2.0.2

## Other core changes

**TBC**