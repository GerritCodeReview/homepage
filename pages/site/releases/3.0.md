---
title: "Gerrit 3.0.0 Release"
permalink: 3.0.html
hide_sidebar: true
hide_navtoggle: true
toc: true
---

Download: **[3.0.1](https://gerrit-releases.storage.googleapis.com/gerrit-3.0.1.war)**
| [3.0.0](https://gerrit-releases.storage.googleapis.com/gerrit-3.0.0.war)

Documentation: **[3.0.1](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.1/index.html)**
|[3.0.0](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.0/index.html)

## Release Highlights

* Removal of GWT UI

  The GWT UI is removed and PolyGerrit is now the only UI.

* Removal of ReviewDb

  The database backend for changes, accounts, groups and projects ("ReviewDb") is
  removed and this metadata is now stored in git ("NoteDb").

  A database is still needed for account patch reviews, which stores the 'reviewed'
  flag for files in a review per user. The default backend is H2, but MySQL,
  PostgreSQL and MariaDb are also supported. See the
  [documentation](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.0/config-gerrit.html#accountPatchReviewDb)
  for details.

  It is also possible for plugins to provide another backend by implementing the
  [`AccountPatchReviewStore`](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.0/dev-plugins.html#account-patch-review-store)
  interface.

* New quota enforcer extension point.

* [Issue 4040](https://bugs.chromium.org/p/gerrit/issues/detail?id=4040):
Support for signed push with GPG subkeys.

* New core plugins: `delete-project`, `gitiles`, `plugin-manager`, and `webhooks`.

## Important Notes

### Schema Changes

This release contains schema changes. To upgrade:

``` sh
  java -jar gerrit.war init -d site_path
```

### Breaking Changes

* Reverse DNS lookup is now disabled by default

  The `gerrit.disableReverseDnsLookup` option with default value false is replaced
  by `gerrit.enableReverseDnsLookp` also with default value false. This means that
  reverse DNS lookup is now disabled by default.

## New Features

* New quota enforcer extension point.

  Plugins may implement the
  [QuotaEnforcer](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.0/dev-plugins.html#quota-enforcer)
  interface to enforce
  [quotas](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.0/dev-plugins.html#quota-enforcer).

* [Issue 4040](https://bugs.chromium.org/p/gerrit/issues/detail?id=4040):
Support for signed push with GPG subkeys.

  It is now possible to use a GPG subkey when pusing commits with signed push.

* [Issue 6053](https://bugs.chromium.org/p/gerrit/issues/detail?id=6053):
Support for searching on mobile devices.

* [Issue 8535](https://bugs.chromium.org/p/gerrit/issues/detail?id=8535):
Support for plugin config entries in the PolyGerrit UI.

  Configuration entries defined by server-side plugins are now displayed
  in the UI.

* New method to get UI top menus in the config API.

* New core plugins.

  The `delete-project`, `gitiles`, `plugin-manager`, and `webhooks` plugins are
  now core plugins bundled with the release, and can be installed during site
  initialization.

## Dependency Updates

* Add dependency on resemblejs

* Remove dependency on apache derby

* Remove dependency on gwtjsonrpc

* Remove dependency on gwtorm

* Remove dependency on postgresql

* Upgrade asm to 7.0

* Upgrade auto-value to 1.6.5

* Upgrade codemirror-minified to 5.43.0

* Upgrade commons-lang3 to 3.8.1

* Upgrade gitiles-blame-cache and gitiles-servlet to 0.2-8

* Upgrade guava to 27.0.1-jre

* Upgrade guice to 4.2.2

* Upgrade prolog-cafe to 1.4.4

* Upgrade soy to 2019-03-11

* Upgrade truth to 0.43

## Native packaging

* Upgrade the Docker/Ubuntu image to Ubuntu 18.04

* Upgrade the Docker/CentOS image to CentOS 7.6.1810

* RPM/Deb: Remove Gerrit service start upon package setup.

  Gerrit service is no longer started automatically after the package installation,
  but requires manual invocation of the `/etc/init.d/gerrit start` command, or
  the configuration of the service for auto-start and the reboot of the machine.

* Docker: auto-init the Gerrit site during first start of the container.

  Simplify the configuration and management of Docker setups by automatically
  detecting if a `$GERRIT_SITE/git/All-Projects.git` exists and, if it doesn't,
  invoke the Gerrit init step in batch mode.

## Bugfix Releases

### 3.0.2

* **Breaking changes**

  * Increase default number of SSHD threads to at least 4.

    The default value of the `sshd.threads` setting is changed to be either two
    times the number of available CPU cores, or 4, whichever is greater.

  * [Issue 11216](https://bugs.chromium.org/p/gerrit/issues/detail?id=11216):
  Remove hard-coded bug tracker URL and use configured value if present.

* New Features

  * [Issue 11201](https://bugs.chromium.org/p/gerrit/issues/detail?id=11201):
  Add ability to have custom label with a missing text value in PolyGerrit

  * Add a PolyGerrit extension point to show a small banner next to the search bar.

    A plugin or a site theme (gerrit-theme.html) may register a custom
    Element to be inserted into this endpoint.

  * Expose Gerrit's GWT client library in the plugin API

  * [Issue 5791](https://bugs.chromium.org/p/gerrit/issues/detail?id=5791):
  Add an extension point to allow setting a site banner.

  * Add an extension point to allow custom site footers.

  * Extend QuotaBackend and QuotaEnforcer extension points.

  * Introduce repository size quota enforcer.

    Introduce "/repository:size" quota group that gets examined
    when commits get pushed to the repository.

  * [Issue 10166](https://bugs.chromium.org/p/gerrit/issues/detail?id=10166):
  Add shortcuts for dashboard and watched changes in PolyGerrit

  * [Issue 11028](https://bugs.chromium.org/p/gerrit/issues/detail?id=11028):
  Add support for "Link Another Identity" screen in PolyGerrit

  * CommitApi: Add method to get commit info

  * Allow to set content type in the PolyGerrit plugin REST API interface

  * Add `changeCleanup.cleanupAccountPatchReview` configuration parameter to
  wipe out AccountPatchReview data when change gets auto-abandoned.

* Elasticsearch Updates:

  * [Issue 11266](https://bugs.chromium.org/p/gerrit/issues/detail?id=11266):
  Add support for Elasticsearch 6.8.

  * [Issue 11267](https://bugs.chromium.org/p/gerrit/issues/detail?id=11267):
  Add support for Elasticsearch 7.3.

  * Update elasticsearch-rest-client to 7.3.1.

* PolyGerrit fixes

  * [Issue 11350](https://bugs.chromium.org/p/gerrit/issues/detail?id=11350):
  Upgrade highlight.js to latest master revision.

  * [Issue 11096](https://bugs.chromium.org/p/gerrit/issues/detail?id=11096):
  Fix page not opening after a couple of times switching between GWT and PolyGerrit UI.

  * Fix dialog popup when going to /admin/create-project.

  * Add support for /groups

  * Redirect /groups/self to /settings/#Groups

  * [Issue 10733](https://bugs.chromium.org/p/gerrit/issues/detail?id=10733):
  Fix anchors not working at page load on settings page

  * [Issue 10062](https://bugs.chromium.org/p/gerrit/issues/detail?id=10062):
  Fix Polygerrit converting plus (+) to space when calling email.confirm API,
  and then failing with "invalid token"

* Other fixes

  * [Issue 11348](https://bugs.chromium.org/p/gerrit/issues/detail?id=11348):
  Display on error_log the progress of the online migration from ReviewDb to NoteDb.

  * [Issue 11235](https://bugs.chromium.org/p/gerrit/issues/detail?id=11235):

    Fix ls-user-refs reporting wrong results because it was not using the identity of the username
    given as parameter.

  * [Issue 11222](https://bugs.chromium.org/p/gerrit/issues/detail?id=11222):
  Skip receive.maxBatchCommits when skip-validation option is passed and a commit validator implements
  shouldValidateAllCommits

  * [Issue 11083](https://bugs.chromium.org/p/gerrit/issues/detail?id=11083):
  Set the correct new revision on change-merged events when submitting by push.

    When multiple changes are submitted at the same time by push, the new revision
    in all the change-merged events should be the revision of the head of the
    destination branch after all changes are submitted.

  * Adapt `gerrit.sh` script to work on Alpine Linux.

  * [Issue 10855](https://bugs.chromium.org/p/gerrit/issues/detail?id=10855):
  Fix standalone GWT plugin builds failing because of a broken transitive load of GWT_PLUGIN_DEPS for in-tree plugin builds

  * [Issue 11148](https://bugs.chromium.org/p/gerrit/issues/detail?id=11148):
  Speedup online reindex migration by skipping evaluation of submit rules for closed changes.

  * [Issue 11016](https://bugs.chromium.org/p/gerrit/issues/detail?id=11016):
  Fix Gerrit slave site init leads to update failure on system_config caused by read-only transaction

  * [Issue 11106](https://bugs.chromium.org/p/gerrit/issues/detail?id=11106):
  Fix missing comment context for left side in email notifications.

  * [Issue 11110](https://bugs.chromium.org/p/gerrit/issues/detail?id=11110):
  Do not swallow the exceptions that caused REST-API to return with a status >= 400.

  * [Issue 11086](https://bugs.chromium.org/p/gerrit/issues/detail?id=11086):
  When a WIP change is implicitly merged by direct push to the branch, its WIP
  state is unset.

  * [Issue 11082](https://bugs.chromium.org/p/gerrit/issues/detail?id=11082):
  Close changes oldest first when submitting on push.

  * Submit: Fix wrong conflict resolution

  * Add methods on the change API to get comments and draft comments as lists.

  * Make DefaultChangeReportFormatter extendible by plugins.

  * Add back the oneByExternalId method on InternalAccountQuery.

    This was removed in 2.16 but is added back so it can be used by plugins
    and extensions.

  * Fix and expand documentation of REST API to get revision files

  * Fix detecting changes of parent trees when computing change kind for merge
  commit.

    A new patch set of a merge change is considered as NO_CHANGE if the
    commits have the same delta and trees. For merge commits this includes
    comparing the trees of the parent commits.

  * Reduce log spam of "setting reductionLimit" debug messages of the Prolog
  engine.

  * [Issue 11325](https://bugs.chromium.org/p/gerrit/issues/detail?id=11325):
  Do not update change set modified date on ReviewDb when a user delete all its
  draft changes.

  * Fix rebase change REST API returned status code.

    The rebase change REST API return 422 Unprocessable Entity, instead of 500
    Internal Server Error, If the specified base change is missing

  * Catch all exceptions for reporting on Schema_130 migration and display the
  name of the project that failed the migration.

  * [Issue 11271](https://bugs.chromium.org/p/gerrit/issues/detail?id=11271)
  Update rules_go to 0.18.6 for compatibility with Bazel 0.27.0

  * [Issue 11248](https://bugs.chromium.org/p/gerrit/issues/detail?id=11248):
  Ensures that a newly added label in a parent project is available in the ACL
  configuration of a child project.

* Replication plugin fixes:

  * [Issue 10852](https://bugs.chromium.org/p/gerrit/issues/detail?id=10852):
  Fix stale replications caused by an in-flight pushes not properly removed when failed.

  * [Issue 11204](https://bugs.chromium.org/p/gerrit/issues/detail?id=11204):
  Fix creation of missing repository when replicating to a Gerrit server over HTTP.

  * [Issue 11175](https://bugs.chromium.org/p/gerrit/issues/detail?id=11175):
  Introduce new ref-filtering extension point for preventing replication of outdated SHA1s,
  mostly useful in a multi-site scenario to prevent split-brain.

  * [Issue 11055](https://bugs.chromium.org/p/gerrit/issues/detail?id=11055):
  Fix failure to start when re-triggering persisted events

  * [11172](https://bugs.chromium.org/p/gerrit/issues/detail?id=11172):
  Fix persisted event is removed before all replications to all nodes are completed.

  * When replication plugin is stopped or reloaded, mask all the currently pending as cancelled.

  * Allow to configure timeout for SSH connections and SSH commands.

    The timeouts can be configured with `gerrit.sshConnectionTimeout` and
    `gerrit.sshCommandTimeout`, respectively.

  * Make more classes and fields public/protected to ease extensibility.

  * Improve handling of remote repository creation failures.

  * Reintroduce boolean return value of methods in AdminApi.

  * Refactor AdminApiFactory to an interface with a default implementation that
  gets bound as a dynamic item, which can be replaced by derived implementations.

  * When rescheduling due to in-flight push also log the in-flight task ID.

* Hooks plugin fixes:

  * [Issue 10823](https://bugs.chromium.org/p/gerrit/issues/detail?id=10823):
    Allow to configure the number of hook execution workers.

    By setting `hooks.executorThreads` the number of workers can be configured.
    If not set, it defaults to 1 which was the previously fixed value.

### 3.0.1

* Upgrade JGit to 5.3.1.201904271842-r.

* [Issue 10858](https://bugs.chromium.org/p/gerrit/issues/detail?id=10858):
Fix starting Gerrit under Tomcat 8.

* [Issue 10664](https://bugs.chromium.org/p/gerrit/issues/detail?id=10664):
Fix duplicate key detection in MySQL patch review database.

* [Issue 11016](https://bugs.chromium.org/p/gerrit/issues/detail?id=11016):
Fix failure to initialize on slave.

* [Issue 10763](https://bugs.chromium.org/p/gerrit/issues/detail?id=10763):
Fix ACLs to allow regexes for tag and ref permissions.

  The documentation states that reference names can also be described with
  a regular expression by prefixing the reference name with `^`, but the UI
  only showed the creation field when a non-regex name was used.

* [Issue 11082](https://bugs.chromium.org/p/gerrit/issues/detail?id=11082):
Close changes oldest first when submitting on push.

* [Issue 11059](https://bugs.chromium.org/p/gerrit/issues/detail?id=11059):
Fix setting `BLOCK` on partial label range in permissions.

* [Issue 10790](https://bugs.chromium.org/p/gerrit/issues/detail?id=10790):
Avoid evaluating submit rules twice for open changes.

  Prolog submit rules were evaluated twice per page view for an open change,
  which caused performance degradation on projects defining complex rules.

* [Issue 10943](https://bugs.chromium.org/p/gerrit/issues/detail?id=10943):
Set `References:` header on new change notification mail.

  GMail changed the way
  [emails are grouped in conversation view](https://gsuiteupdates.googleblog.com/2019/03/threading-changes-in-gmail-conversation-view.html),
  which, combined with the fact that
  [Amazon SES changes the `Message-ID` header](https://forums.aws.amazon.com/message.jspa?messageID=262855),
  resulted in the new change notification email not being grouped with
  subsequent emails related to the same change.

* [Issue 10952](https://bugs.chromium.org/p/gerrit/issues/detail?id=10952):
Fix definition of `PID` in `gerrit.sh`.

* [Issue 10852](https://bugs.chromium.org/p/gerrit/issues/detail?id=10852):
Replication plugin: Fix scheduling starvation.

* [Issue 10896](https://bugs.chromium.org/p/gerrit/issues/detail?id=10896):
Fix eliding project name without slash in notification emails.

* Show submit button with tooltip when not allowed to submit.

  The submit button was hidden when the user did not have permission to submit,
  or other conditions prevented submit (for example the change being WIP).

* Don't send "GPG keys added" notification when no GPG keys were added.

  A GPG key update can include both addition and removal of GPG keys. The
  notification email for addition of new keys was always sent, even if the
  update only removed keys.

* Update email notifications on changing security related settings.

  Email notifications are now sent when a GPG or SSH key is removed, and
  when the HTTP password is deleted or changed.

  An email notification is now always sent when an SSH key is added to an
  account, even when it was added by an administrator.

  These notifications allow to alert the user if their account is compromised
  and keys or password are altered by the attacker.

* Remove explicit dependency on protobuf_java.

  The protobuf_java library is now consumed from rules_closure.

* Improve performance of migration of accounts to schema 146.

  * Migration of the accounts is parallelized. The default number of threads
    used is the number of available processors. This can be customized using
    the `threadcount` system property.

  * Before the migration, `gc --prune=now` is executed.

  * When hosted on `FileRepository`, refs are packed after migration of every
    1000 accounts.

  * A progress indicator counts every 100 accounts migrated.

* Allow commit validation listeners to ignore the `skip-validation` push option.

  Gerrit allows certain users to skip validation of new commits by passing
  the `skip-validation` push option.

  A new method `shouldValidateAllCommits` is added on the
  `CommitValidationListener`, to allow plugin implemented validators to
  override this option and always be invoked for new commits. The new
  method has a default implementation that returns `false` meaning that
  existing implementations don't need to be modified and will behave the
  same as before.

* Optimize commit and ref operation validation for non-ff push.

  On a non-ff push all the commits were validated before the ref operation
  was validated. On a push with many commits, validating all the commits is
  wasteful in the case where the ref operation is rejected. The logic is
  changed so that the ref operation validation is performed before the commit
  validation.

* Disallow change index task duplication.

  It was possible for multiple index tasks to be queued for the same change.

* Fix formatting issues and inconsistencies in soy email templates.

* Use URL Formatter interface to generate URL in outgoing emails.

* Fix error message when JRE is not found when starting Gerrit.

  The error message recommended to check for a JRE ">= 1.7", but Gerrit requires
  Java 8 minimum.

* Expose the `createProject` method of the `CreateProject` class to plugins.

  This allows plugins to directly invoke the project creation, avoiding the
  checks that are performed when invking via the `apply` method.

* Expose the jsr305 library in the plugin API.

* Upgrade gitiles to 0.2-10.

  Includes a fix for rendering of metalinks in the navigation bar.

* Elasticsearch fixes

  * [Issue 10499](https://bugs.chromium.org/p/gerrit/issues/detail?id=10499):
  Set default number of shards according to Elasticsearch version.

    In Elasticsearch version 7.0 the default number of shards was reduced from
    5 to 1.

    See the [Elasticsearch documentation](https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started-concepts.html#getting-started-shards-and-replicas)
    for details.

  * [Issue 10496](https://bugs.chromium.org/p/gerrit/issues/detail?id=10496) and
  [Issue 10844](https://bugs.chromium.org/p/gerrit/issues/detail?id=10884):
  Fix usage of `include_type_name` in index creation.

  * Add support for Elasticsearch 7.1.

  * Upgrade elasticsearch-rest-client to 7.1.1.

* PolyGerrit UI fixes:

  * Only display 404 page on initial load.

  * Don't reload when viewing dashboard.

  * Fix hiding the HTTP password screen.

    It was possible for the HTTP password to be un-hidden using CSS.

  * Add an extension point to allow adding links to the user header.

* Documentation updates

  * [Issue 10897](https://bugs.chromium.org/p/gerrit/issues/detail?id=10897):
  Update links to Google individual and corporate CLA pages.

  * Clarify that account must have a username to be able to set HTTP password.

  * Fix formatting in project config documentation.
