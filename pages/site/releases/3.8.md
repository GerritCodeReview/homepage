---
title: "Gerrit 3.8.0"
permalink: 3.8.html
hide_sidebar: true
hide_navtoggle: true
toc: true
---


Download: **[3.8.0-rc1](https://gerrit-releases.storage.googleapis.com/gerrit-3.8.0-rc1.war)**

Documentation: **[3.8.0-rc1](https://gerrit-documentation.storage.googleapis.com/Documentation/3.8.0/index.html)**

## Release highlights

## Important notes

### Schema and index changes

This release doesn't contain schema changes.

### Offline upgrade

The `changes` index version has been increased to version _82_. By default, the
index is automatically rebuilt upon the Gerrit startup after the
upgrade.

Download the gerrit.war and run the `init` and then `reindex` program:

```sh
  java -jar gerrit.war init -d site_path
  java -jar gerrit.war reindex --index changes -d site_path
```

### Online upgrade with zero-downtime

Gerrit v3.8.x supports zero-downtime upgrade from Gerrit v3.7.2 or later when
configured using a [high-availability configuration](https://gerrit.googlesource.com/plugins/high-availability/+/refs/heads/master/README.md),
and the Git repositories are stored in a shared filesystem such as NFS or
similar.

During the zero-downtime upgrade, Gerrit end-users would not notice any outage
or service disruption. They will be able to perform any read/write Gerrit
operation on the GUI or using any API.

The zero-downtime upgrade consists of the following steps:

1. Have Gerrit servers running v3.6.3 or later, in high-availability
   configuration, healthy and able to handle the incoming traffic properly.
2. Set `gerrit.experimentalRollingUpgrade` to `true` in `gerrit.config` on both Gerrit primaries.
3. Set the Gerrit server unhealthy.
4. Shutdown the Gerrit server, update gerrit.war and plugins to v3.8.x and start
   Gerrit again.
5. Verify that the Gerrit server is working properly (e.g. run automated smoke
   tests) and then make it healthy again.
6. Wait for the Gerrit server to start serving traffic normally.
7. Repeat steps 3. to 6. for all the other Gerrit servers.
8. Remove `gerrit.experimentalRollingUpgrade` from `gerrit.config` on both Gerrit primaries.

### Downgrade

Downgrade to any Gerrit v3.7.x release is possible, but requires the
following manual steps:

1. Shutdown all migrated Gerrit v3.8.x servers
2. Update the gerrit.war and plugins to the previous v3.7.xversion
3. Run offline change reindexing using the previous gerrit.war version

```sh
  java -jar gerrit.war init -d site_path
  java -jar gerrit.war reindex --index changes -d site_path
```

4. Startup Gerrit server

### Native packaging

* GerritForge RPM repository updated for arm64 architecture

  [GerritForge RPM v1.4](https://gerritforge.com/gerritforge-repo-1-4.noarch.rpm)
  has been released, including the native packages for arm64 architecture.

* [gerrit:3.8.0-almalinux8](https://hub.docker.com/r/gerritcodereview/gerrit/tags?page=1&name=3.8.0-almalinux8)
  OS base image upgraded to [AlmaLinux 9.1](https://wiki.almalinux.org/release-notes/9.1.html)

* [gerrit:3.8.0-ubuntu22](https://hub.docker.com/r/gerritcodereview/gerrit/tags?page=1&name=3.8.0-ubuntu22)
  OS base image upgraded to [Ubuntu 22](https://discourse.ubuntu.com/t/jammy-jellyfish-release-notes/24668)

* DockerHub images for arm64 architecture

  [DockerHub Gerrit images](https://hub.docker.com/r/gerritcodereview/gerrit/tags?page=1&name=3.8.0)
  include images for arm64 architecture.

### Breaking changes

* [Change 360756](https://gerrit-review.googlesource.com/360756):
Disallow uploading new prolog rules files.

    Clients should use submit-requirements instead. Please note that
    modifications and deletions of existing rules.pl files are still
    allowed.

* [Change 360054](https://gerrit-review.googlesource.com/360054):
Allow callers to format create change response

    Add `ListChangeOptions` to `ChangeInput` and `ApplyPatchPatchSetInput` such that
    callers can control what fields should be formatted in the returned ChangeInfo.
    For ApplyPatch, this commit changes the default formatting options from
    `CURRENT_COMMIT` to `no-options`.

* [Change 360219](https://gerrit-review.googlesource.com/360219):
Delete vote now fails for an already deleted vote

  An e-mail was sent each time when a vote was executed, even if the label had
  been already set to 0 and thus no actual changes were made.

  This fix can break some scenarios, where the caller expect that
  DeleteVoteOp is always succeed after the label was added at least once.
  This should be fixed on the caller side.

* [Change 358975](https://gerrit-review.googlesource.com/358975):
Skip account visibility checks when querying changes

  Skipping the account visibility check when querying changes of participating
  users participating in the change (the change owner, reviewers, CCs etc.).
  This affects several search predicates: `owner` / `uploader` / `label`
  + `user` / `reviewer` / `attention`
  / `commentby`

### Other changes

## Plugin changes

* download-commands:
  * [Change 365142](https://gerrit-review.googlesource.com/365142):
    Only chmod if commit-msg hook was fetched successfully
  * [Change 362879](https://gerrit-review.googlesource.com/362879):
    Allow to hide download schemes in the UI
  * [Change 359976](https://gerrit-review.googlesource.com/359976):
    Consistently use `git rev-parse` to find hooks-dir
  * [Change 359823](https://gerrit-review.googlesource.com/359823):
    Always use HTTP when downloading commit-msg hook
* reviewnotes:
  * [Change 365655](https://gerrit-review.googlesource.com/365655):
    Add comment count to review notes.
* webhooks:
  * [Change 365175](https://gerrit-review.googlesource.com/365175):
    Add HTTP response code 'SC_ACCEPTED' (202) as success case in response handler
* codemirror-editor:
  * [Change 363002](https://gerrit-review.googlesource.com/363002):
    Add the light-mode to CodeMirror editor
  * [Change 361395](https://gerrit-review.googlesource.com/361395):
    Add support for dark mode
  * [Change ](https://gerrit-review.googlesource.com/360836):
    Update CodeMirror to V6

## Performance changes

* [Change 360646](https://gerrit-review.googlesource.com/360646):
  Introduce a per request ref cache for better performance

  Add a new `core.usePerRequestRefCache` setting. If the setting is true, use a
  per request (currently per request thread)
  ref cache. This helps reduce the overhead of checking if the packed-refs file
  is outdated. This setting is true by default.

* [Change 365144](https://gerrit-review.googlesource.com/365144):
  Destination queries now use the change index

  `destination` predicate now matches any number of branch names with O(1)
  efficiency.

* [Issue 16072](https://bugs.chromium.org/p/gerrit/issues/detail?id=16072):
  Fix "showchange" plugin event being triggered twice on patchset change

* [Change 363074](https://gerrit-review.googlesource.com/363074):
  Performance optimization for cold-cache groups

* [Change 350455](https://gerrit-review.googlesource.com/350455):
  Enables transition from LDAP to Google OAuth

  When transitions to Google OAuth from LDAP, if the account exists with the same
  e-mail then the account ID is reused. This allows to have the same user history
  post migration.

* [Change 360755](https://gerrit-review.googlesource.com/360755):
  Added support for rebasing chains on behalf of the uploaders

## Gerrit UI changes

* [Change 361574](https://gerrit-review.googlesource.com/361574):
  Add darkMode param to gr-editor-view extension point

* [Change 358179](https://gerrit-review.googlesource.com/358179):
  Add a new endpoint for a profile page

* [Change 360134](https://gerrit-review.googlesource.com/360134):
  Fix “Old Patchset” being displayed on current edits

* [Issue 16545](https://bugs.chromium.org/p/gerrit/issues/detail?id=16545):
  Fix issue in in-line editor where files were not shown the changes in file
  list

## Documentation changes

* [Change 361696](https://gerrit-review.googlesource.com/361696):
  Remove prolog rules doc page mention from the index page

    users should use submit-requirements instead of prolog rules

## End-to-End tests changes

## JGit changes

* Upgrade jgit to 5ae8d28. Notable changes are:
  - Implement a snapshotting RefDirectory for use in request scope
  - If tryLock fails to get the lock another gc has it
  - Fix GcConcurrentTest#testInterruptGc
  - Don't swallow IOException in GC.PidLock#lock
  - Check if FileLock is valid before using or releasing it
  - Use Java 11 ProcessHandle to get pid of the current process
  - UploadPack: use allow-any-sha1-in-want configuration
  - Acquire file lock "gc.pid" before running gc
  - Fix getPackedRefs to not throw NoSuchFileException
  - Add pack options to preserve and prune old pack files
  - Allow to perform PackedBatchRefUpdate without locking loose refs
  - Document option "core.sha1Implementation" introduced in 59029aec

## Other dependency changes

## Other core changes

* [Change 367654](https://gerrit-review.googlesource.com/367654)
  Fixed rebasing chain when a checks refs exists for one of the changes

    Fixed a NPE that might have been thrown when rebasing on changes for which
    a `checks` ref exists.

* [Change 366334](https://gerrit-review.googlesource.com/366334)
  Added 'a' as alias for the 'author' search operator

    This follows the example of other aliases, e.g. 'o' for 'owner' or 'r' for '
    reviewer'.

* [Change 365901](https://gerrit-review.googlesource.com/365901)
Added global capability that allows to view secondary emails

    If users have multiple emails only the preferred email is visible to other
    users. Now, with the new `View Secondary Emails`
    global capability it's possible to allow viewing all emails.

* [Change 361460](https://gerrit-review.googlesource.com/361460)
Allow editing commit message from Change-Id: to Link: footer

    This allows to edit the commit message by replacing a valid 'Change-Id:' footer
    for a valid 'Link:' footer.

* [Change](https://gerrit-review.googlesource.com/359974):
Fixed calculation of insertions and change buckets for change emails

    When computing change email, the number of files, insertions and deletions didn't
    count the commit message for number of files, but for insertions the lines from
    the commit message were counted, which was inconsistent.

## Bugfix releases

### No release candidate

* Breaking changes

* Performance Fixes

* Bug Fixes

* Dependency Updates

* Documentation Fixes
