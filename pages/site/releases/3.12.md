---
title: "Gerrit 3.12.0-rc0 release (in development)"
permalink: {{ data.major }}.html
hide_sidebar: true
hide_navtoggle: true
toc: true
---

Download: **[3.12.0-rc1](https://gerrit-releases.storage.googleapis.com/gerrit-3.12.0-rc1.war)**

Documentation: **[3.12.0-rc1](https://gerrit-documentation.storage.googleapis.com/Documentation/3.12.0/index.html)**

## Release highlights

### Java 21

The language level used for Gerrit source code is set to Java 21, matching its distributed code level
since [Gerrit v3.11](https://www.gerritcodereview.com/3.11.html#java-21).

It is now mandatory to migrate the Java Virtual Machine to Java 21 and there is no possibility to rebuild
Gerrit source code with Java 17 anymore. Also, all the non-core plugins need to be rebuilt and verified
with Java 21; existing Java 17 plugins may not load or work properly.

### Gitattributes configuration support in JGit merge driver

Gerrit support now the gitattributes with merge driver configuration, introduced in
[Change 441721](https://gerrit-review.googlesource.com/c/gerrit/+/441721).

When Gerrit performs server-side merges, it supports now the reading
and processing of the [gitattributes](https://git-scm.com/docs/gitattributes.html#_built_in_merge_drivers)
reading the global, repo, and in-tree gitattributes files.

The support of gitattributes is implemented for the built-in `binary`
and `union` merge drivers.

### Allow global site-wide override for label's copyCondition

There are two new config variables introduced with [Change 446062](https://gerrit-review.googlesource.com/c/gerrit/+/446062):

- `label.<name>.labelCopyEnforcement`
  for enforcing an additional copy condition for all labels on all projects

- `label.<name>.labelCopyRestriction`
  for reducing forcibly any copy condition for all labels on all projects

When the two settings are defined in `gerrit.config`, then for every project, the final
copyCondition is equivalent to `(<labelCondition> AND NOT <copyRestriction>) OR <copyEnforcement>`

This new behaviour is covered by the experiment feature flag
`GerritBackendFeature__enable_central_override_for_code_review_copy_condition`.

Example of `labelCopyEnforcement` is making sure all negative votes are copied; similarly `labelCopyRestriction`
could be used for making sure only trusted contributors are allowed to submit changes without reviewers
re-confirming that their comments have been addressed.

## Important Notes

### Schema and index changes

Gerrit schema version is unchanged; however, because of the Lucene library bump
to 10.1.0, the on-line upgrade is possible only from Gerrit v3.11 and not from
earlier releases.

All the indexes versions have been increased therefore requiring a reindex:
- `accounts` index version updated to `15`.
- `changes` index version updated to `87`.
- `groups` index version updated to `12`.
- `projects` index version updated to `10`.

### Offline upgrade

- Download the new `gerrit.war`
- Stop Gerrit
- Backup the existing indexes in case a rollback is required
- Ensure all installed plugins are compatible with the new API
- Run init `java -jar gerrit.war init -d site_path --batch`
- Reindex all indexes:

  `java -jar gerrit.war reindex -d site_path`

  See the
  [reindex](https://gerrit-documentation.storage.googleapis.com/Documentation/3.12.0/pgm-reindex.html)
  command for other options.

### Online upgrade with zero-downtime

Gerrit v3.12.x supports zero-downtime upgrade from Gerrit v3.11 when configured
using either
[high-availability](https://gerrit.googlesource.com/plugins/high-availability/+/refs/heads/master/README.md)
or
[multi-site](https://gerrit.googlesource.com/plugins/multi-site/+/refs/heads/master/README.md)
setup.

During the zero-downtime upgrade, Gerrit end-users will not experience any
outage or service disruption and will be able to perform any read/write Gerrit
operation seamlessly.

The zero-downtime upgrade process for high-availability or multi-site setups
consists of the following steps ([demo](https://youtu.be/vK5qsb0W7q4)):

1. Have Gerrit servers running v3.11 in high-availability or multi-site
   configuration, healthy and able to handle the incoming traffic properly.
2. Set one of the Gerrit servers to unhealthy.
3. Shutdown the Gerrit server, update gerrit.war, plugins and libs to v3.12.x and start Gerrit again.
4. Verify that the Gerrit server is working properly (e.g. run automated smoke
   tests) and then make it healthy again.
5. Ensure the Gerrit server is fully caught up with the events that happened while
   it was down before directing traffic to it.
6. Repeat steps 2 to 5 for each of the remaining Gerrit servers.

### Downgrade

Downgrade to Gerrit v3.11 release is possible, but requires the following
manual steps:

1. Shutdown all migrated Gerrit servers
2. Update the gerrit.war and plugins to the previous v3.11 version
3. Init Gerrit

  ```sh
    java -jar gerrit.war init -d site_path --batch
  ```

### Native packaging

The GPG keys for GerritForge's distribution site have changed and need to be reimported
before the upgrade.

- On Debian / Ubuntu):
  `apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 55787ed781304950`

- on AlmaLinux / RedHat / Fedora:
  `rpm --import 'https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x72adb205736d7147da56e8c955787ed781304950â€™`

The Docker-based distributions have been updated:

- AlmaLinux bumped to 9.5

- Ubuntu bumped to Eclipse Temurin 21.0.6_7 (24.04.1 LTS)

## Security Fixes

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/)
  REST API responses are now rendered in the browser rather than downloaded, with XSS protection
  and blocking the use in i-frame.

### Known issues

* [Issue 309098227](https://issues.gerritcodereview.com/issues/309098227) [Change 360646](https://gerrit-review.googlesource.com/360646):
The introduction of a per-request ref cache for better performance may break
the repository consistency

  The addition of a new `core.usePerRequestRefCache` setting, true by
  default, introduced a per request (currently per request thread) ref
  cache, helping reduce the overhead of checking if the packed-refs file
  was outdated. However, in some scenarios, such as multi-site or
  concurrency between `git-receive-pack` and `git-gc`, it may lead to
  split-brain inconsistencies and, in the worst-case scenario, to the
  corruption of the underlying repository.

### Breaking Changes

* [Change 447781](https://gerrit-review.googlesource.com/c/gerrit/+/447781)
  Disabled loading and executing 'rules.pl' by default.

  Prolog rules have been deprecated since Gerrit 3.6; they are now officially disabled
  by default. Gerrit administrators are required to inform all the project owners
  and convert the Prolog rules to Submit Requirements.

  > **NOTE**: It is still possible to enable the Prolog rules processing again with
  > `rules.enable = true` in `gerrit.config`, bearing in mind that the option may not be
  > available anymore in future versions of Gerrit, therefore should be used only
  > as temporary workaround during the migration from Prolog to Submit Requirements.


* [Change 440743](https://gerrit-review.googlesource.com/c/gerrit/+/440743)
  Do not notify listeners when performing online reindexing.

  When performing online reindexing, the notification to listeners and consequent
  sending of the index-change messages in high-availability and multi-site scenarios
  was potentially causing unnecessary traffic and CPU utilisation during the
  schema index updates.

  > **NOTE**: If the reindexing is performed for refreshing outdated index records
  > the online reindexing commands would need to be executed against all the nodes
  > of the Gerrit cluster, as the missed listeners notifications would not trigger
  > the reindexing elsewhere.

* [Change 449321](https://gerrit-review.googlesource.com/c/gerrit/+/449321) [Change 448244](https://gerrit-review.googlesource.com/c/gerrit/+/448244)
  Set Verified label default function to NoBlock for new sites.

  Label functions are deprected and the submittability of changes needs to
  be encoded as Submit Requirements, therefore new Gerrit sites are encouraged
  to define their submittability rather than relying on the legacy label functions
  deprecated since Gerrit v3.6.

  > **NOTE**: Existing sites would not be impacted, unless they were relying on the
  > default label function; however, Gerrit project owners are invited to remove the
  > use of label functions and use Submit Requirements instead.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Added a new MigrateLabelFunctions site program for helping with the migration from
  label functions to Submit Requirements.

* [Issue 390443239](https://issues.gerritcodereview.com/issues/390443239)
  Swap project-created/ref-updated in stream events upon project creation

  Gerrit always produced the project-created/ref-updated in the wrong order,
  generating the ref-update of inexistent projects just created. The order is
  now rectified; however, existing stream events consumers may rely on the
  previous incorrect ordering and potentially break.


* [Change 457802](https://gerrit-review.googlesource.com/c/gerrit/+/457802):
  Users with the `Administrate Server` can see all changes, branches and tags, including
  private changes and `refs/meta/config`.

  Administrators own the Gerrit service and are responsible to investigate
  issues; allowing to access everything simplifies the troubleshooting, avoiding
  them to first assign permissions to themselves, investigate the issue and then
  remember to undo the permission changes.

  Also note that the `skip-visibility` option when querying changes is deprecated
  and effectively ignored. It will be removed in the next version of Gerrit.

  > **NOTE**: With this change, Gerrit would not allow anymore to separate the
  > roles of the security administration and the service management, therefore it
  > is highly recommended to carefully review all the users and groups with the
  > `Administrate Server`.

### New Features

* [Change 442981](https://gerrit-review.googlesource.com/c/gerrit/+/442981):
  Allow restricting users from deleting their own accounts.

  Introduce `accounts.enableDelete` configuration for disabling the ability for users
  to remove themselves from the Gerrit Web-UI.

* [Change 445801](https://gerrit-review.googlesource.com/c/gerrit/+/445801):
  Introduce `is:POSITIVE` and `is:NEGATIVE` as predicates for copyCondition on labels,
  allowing generic matching of any positive or negative reviews.

* [Change 447745](https://gerrit-review.googlesource.com/c/gerrit/+/447745)
  [Change 459463](https://gerrit-review.googlesource.com/c/gerrit/+/459463)
  [Change 447749](https://gerrit-review.googlesource.com/c/gerrit/+/447749)
  [Change 447748](https://gerrit-review.googlesource.com/c/gerrit/+/447748)
  [Change 447746](https://gerrit-review.googlesource.com/c/gerrit/+/447746)
  Assign TRACE_ID for every request and include in all SSH and HTTP interactions.

  Allow to follow the TRACE_ID across all interactions and logs, including
  the sshd_log and httpd_log entries.

* [Change 444441](https://gerrit-review.googlesource.com/c/gerrit/+/444441)
  Add `changeis` predicate as Copy-Condition expressions, with any predicate supported by `is:{predicate}`.

* [Change 444962](https://gerrit-review.googlesource.com/c/gerrit/+/444962) [Change 457801](https://gerrit-review.googlesource.com/c/gerrit/+/457801):
  Add configuration for case-insensitive email matching in account resolution and API.

  Enable case-insensitive matching of the name part of e-mails on a per-domain basis,
  as configured in `accounts.caseInsensitiveLocalPart`.

* [Change 442021](https://gerrit-review.googlesource.com/c/gerrit/+/442021):
  Add `success_count` and `error_count` metrics for ssh requests.

* [Change 447841](https://gerrit-review.googlesource.com/c/gerrit/+/447841):
  Disallow addition of new rules.pl files in projects

  Adding a new `rules.allowNewRules = false` the Gerrit admin can reject
  the addition of new `rules.pl` files into the projects.

* [Change 456684](https://gerrit-review.googlesource.com/c/gerrit/+/456684) [Change 456685](https://gerrit-review.googlesource.com/c/gerrit/+/456685):
  Added draft comments cleanup REST-API and SSH command.

* [Change 456182](https://gerrit-review.googlesource.com/c/gerrit/+/456182):
  Added draftsCleanup background job and automatic scheduled configuration.

* [Change 447629](https://gerrit-review.googlesource.com/c/gerrit/+/447629):
  Added support for adding the Project Owners group as a reviewer

* [Change 445362](https://gerrit-review.googlesource.com/c/gerrit/+/445362):
  Added support for commit validators to return a status + metadata in addition to messages

* [Issue 317340200](https://issues.gerritcodereview.com/issues/317340200):
  Added support for creating a branch on an empty commit.

  Similar to creating a project with an empty commit, allow to create a branch
  not having any initial commit.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Allow creating refs with names matching a commit-ish as long as it is not matching an already existing ref

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Allow custom uploaderin operands for CopyCondition.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Allow opening edit preference in editor view.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/)
  [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Allow to run periodic group and project reindexing.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Attention set when commenting on a thread takes into account owner and unresolved status.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Configure the number of change refs advertised on push to repository.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Default patchset patch file download in the UI to plain-text patch files.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Enable browser notifications for all sites, without the need of a feature-flag.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Enable highlighting for Vue SFC

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Enable highlighting for nix

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Improve file upload dialog and experience

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Improved error message when trying to add a non-internal group as a reviewer

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Mark as ready: Send revert notifications from user that created the revert

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  New config style for period indexers

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Patchsets can now be downloaded as plain-text patch files using the ?raw parameter.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Provide index metric for accounts/changes/groups/projects

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Store/provide merge conflict information for revisions created by Gerrit

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Support WANT_LGTM=all

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  The UI tooltop for submit requirement atoms will now show explanations if implemented by the underlying predicate.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  change-model: Allow viewing change edit commit msg in change-view

### Performance improvements

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Faster replica startup when group reindexing enabled

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  H2Cache BloomFilter will no longer degrade forever

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Implement a new REST-API to remove Gerrit groups

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Reduce bulk action query result payload by not getting already available SUBMIT_REQUIREMENTS data.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  The List Labels endpoint now supports filtering by voteable labels.

### Bug fixes

* [Change 453981](https://gerrit-review.googlesource.com/c/gerrit/+/453981):
  gc_log is no longer overwritten when rotated.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Fix "undefined is not an object (evaluating 'navigator.serviceWorker.controller')"

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Fix progress logging in MultiProgressMonitor

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Fix the reference counting for a correct release of repositories from the JGit in-memory repository cache

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Fix timeouts calculation in SshDaemon

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Fix triggering mentions on Safari and Firefox

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  GitFileDiffCacheImpl: cancel tasks failing due to timeout or interrupt

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  H2 Caches are operational before bloomFilters are built

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Include TRACE_ID in error_log for unhandled SSH command errors

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Include SSH session in the error_log entries

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Lookup imported change by change number otherwise it cannot be found.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Make "message:" predicate for SR consistent with search

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Respect project config and user preference for creating changes as work-in-progress by default for the Revert REST endpoint

* [Change 447640](https://gerrit-review.googlesource.com/c/gerrit/+/447640) [Change 447639](https://gerrit-review.googlesource.com/c/gerrit/+/447639):
  Reviewer suggestion for empty query: Fallback to project owners and reviewers of recent changes.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  url-util: Don't encode just a slash for loginUrl

## Frontend changes

* [Change 449581](https://gerrit-review.googlesource.com/c/gerrit/+/449581)
  Add HTTP request header to distinguish plugins from core.

  A new HTTP header `X-Gerrit-Request-Origin` added to the requests coming
  from the Gerrit Web-UI helps identify whether an API is invoked from `core-ui`
  or `plugin:<plugin-name>` for requests originated from plugins.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
   gr-create-change-dialog: Give more width to messageInput (Description)

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
   gr-diff: Use native getSelection().getComposedRanges() on safari

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
   gr-search-bar: Fix negations with autocomplete

## Other Changes

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Added sample ref-updated hook to repack repositories geometrically

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Script providing extended git gc functionality

* [Change 438123](https://gerrit-review.googlesource.com/c/gerrit/+/438123):
  Add python-based CLI to maintain Gerrit sites

## Documentation changes

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Clarify the documentation of sshd.waitTimeout

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Document footer frontend endpoint decorators

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Document the use of Gerrit-CI by the contributors and maintainers

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Update the config-gerrit documentation mentioning a caveat of using listProjectsFromIndex setting

## Plugin changes

* [Change 441561](https://gerrit-review.googlesource.com/c/gerrit/+/441561)
  Introduce a new `CachesApi` endpoint for accessing and flushing caches from plugins.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Introduce Repository leak detection when using AbstractDaemonTest

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Add @NoGitRepositoryCheckIfClosed for plugins to avoid failing when a Git Repository leak is detected

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Add publish-edit event type for plugins to use.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Added an extension point that allows to get to know about validation options

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Added an extension point that is invoked after a commit passed the validations

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Added extension point that allows listening to retries

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Allow SubmitRequirement atoms to return an explanation

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Updated ExternalIncludedIn extension point to allow plugins to use change information to obtain included-ins

* [Change 444804](https://gerrit-review.googlesource.com/c/gerrit/+/444804)
  [Change 442742](https://gerrit-review.googlesource.com/c/gerrit/+/442742):
   Mark setup_gjf.sh and run_gjf.sh for removal and replace them with one script gjf.sh.

## Other dependency changes

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Bump Guava to v33.1 and adapt the associated use of Suppliers in ExternalIdReader.

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Remove net.i2p.crypto:eddsa

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Repack jgit-servlet to use javax instead of jakarta

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Update Lucene to 10.1.0

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Update asm version to 9.7

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Update auto-value to 1.11.0

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Update bouncycastle to 1.80

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Update ch.qos.reload4j:reload4j to 1.2.26

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Update com.h2database:h2 to 2.3.232

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Update commons-io to 2.18.0

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Update errorprone to 2.36.0

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Update flogger to 0.8

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Update gson to 2.12.1

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Update guava to 33.4.0-jre

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Update io.dropwizard.metrics:metrics-core to 4.2.30

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Update org.apache.mina:mina-core to 2.0.27

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Update org.tukaani:xz to 1.10

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Update truth to 1.4.4

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  update codemirror packages

* [Change ](https://gerrit-review.googlesource.com/c/gerrit/+/):
  Update jgit to f22643b39 and apache sshd to 2.15.0
