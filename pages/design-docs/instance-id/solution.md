---
title: ""
hide_sidebar: true
hide_navtoggle: true
toc: false
---

# Overview

Gerrit has already a [parameter](https://gerrit-documentation.storage.googleapis.com/Documentation/3.1.4/config-gerrit.html#gerrit.instanceName)
to define an identifier for the instances. This could be included in the events
generated by the different nodes.

## <a id="implementation"> Implementation

### Setup

The `instanceName` is currently set in the `gerrit.config`. It defaults to the
full hostname if not set.

### Propagation

Each event will need to be labelled with the name of the instance it has been
generated from.
The `com.google.gerrit.server.events.Event` will need to be modified to accommodate
the new parameter. `instanceName` defaults to the full hostname, hence Events
can always be signed.

# Current consumers compatibility

## Gerrit Jenkins Trigger Plugin

The addition of an `instanceName` in the Events wonâ€™t affect the Gerrit Jenkins
Trigger Plugin, since the DTO used is really lax and decoupled from Gerrit.
Additional fields added to the Event will just be ignored.

## Other plugins

I used [this query](https://cs.bazel.build/search?q=r%3Aplugin++com.google.gerrit.server.events.Event&num=200)
and [this other one](https://github.com/search?l=Java&q=org%3AGerritForge+%22events.Event%22+NOT+Test&type=Code)
to assess the plugins that might be impacted by the change of the
`com.google.gerrit.server.events.Event`.

Plugins that would need adaptation with this change will be the
_multi-site_ and the _events-broker_ since they will have to start using `instanceName`
instead of the multi-site definition of `instanceId`.

The _events-log_ plugin, used for example by the Gerrit Jenkins Trigger Plugin,
might also need extra work to store the extra field in the database.

The _high-availability_ won't need to be modified, but there will be the chance
of simplifying it and make it more resilient, since it won't have to store the
forwarded events in the thread local storage anymore.
